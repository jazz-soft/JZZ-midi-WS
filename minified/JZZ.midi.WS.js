(i=>{"object"==typeof exports&&"undefined"!=typeof module?module.exports=i.WS=i:"function"==typeof define&&define.amd?define("JZZ.midi.WS",["JZZ"],i):i(JZZ)})(function(d){var i;function n(i){if(!(this instanceof n))return new n(i);(self=this).wss=i,this.cli=[],this.ins={},this.outs={},this.inputs=[],this.outputs=[],i.on("connection",function(i){((i,n)=>{for(var t=0;t<i.length;t++)if(i[t]==n)return;i.push(n)})(self.cli,i),i.on("error",console.error),i.on("message",function(i){try{var n=JSON.parse(i);n.midi&&self.outs[n.id]&&self.outs[n.id].send(l(n.midi))}catch(i){}}),i.on("close",function(){self.cli=((i,n)=>{for(var t=[],e=0;e<i.length;e++)i[e]!=n&&t.push(n);return t})(self.cli,i)}),i.send(e(self))})}function e(i){return JSON.stringify({info:{inputs:i.inputs,outputs:i.outputs}})}function o(i,n){for(var t=0;t<i.cli.length;t++)i.cli[t].send(n)}function h(i){for(var n={midi:i.splice(0,i.length)},t=Object.keys(i),e=0;e<t.length;e++)"length"!=t[e]&&"_from"!=t[e]&&(n[t[e]]=i[t[e]]);return n}function l(i){for(var n=new d.MIDI(i.midi),t=Object.keys(i),e=0;e<t.length;e++)"midi"!=t[e]&&(n[t[e]]=t[t[e]]);return n}function p(i,n){for(var t=[],e=[],o=0;o<i.length;o++)n.includes(i[o])||t.push(i[o]);for(o=0;o<n.length;o++)i.includes(n[o])||e.push(n[o]);return[t,e]}d.WS||(i="undefined"==typeof WebSocket?require("ws"):WebSocket,n.prototype.addMidiIn=function(n,i){var t;this.ins[n]||(this.ins[n]=i,this.inputs.push(n),t=this,i.connect(function(i){o(t,JSON.stringify({id:n,midi:h(i)}))}),o(this,e(this)))},n.prototype.addMidiOut=function(i,n){this.outs[i]||(this.outs[i]=n,this.outputs.push(i),o(this,e(this)))},d.WS={connect:function(s){var r=new i(s),u={},f=[],c=[];r.onerror=console.error,r.onclose=function(){},r.onmessage=function(i){try{var n=JSON.parse(i.data);if(n.info){for(var t,e=p(n.info.inputs,f),o=0;o<e[0].length;o++)t=new d.Widget,u[e[0][o]]=t,d.addMidiIn(s+" - "+e[0][o],t),f=n.info.intputs;for(e=p(n.info.outputs,c),o=0;o<e[0].length;o++)t=new d.Widget({_receive:((n,t)=>function(i){n.send(JSON.stringify({id:t,midi:h(i)}))})(r,e[0][o])}),e[0][o],d.addMidiOut(s+" - "+e[0][o],t),c=n.info.outputs}else n.midi&&u[n.id]&&u[n.id].send(l(n.midi))}catch(i){console.error(i.message)}}},Server:n})});